---
import { quotes } from "../data/quotes"
import GradientText from "./GradientText.astro"
import QuoteCard from "./QuoteCard.astro"
---

<section class="bg-dots relative overflow-hidden border-b border-neutral-3 py-16 lg:py-24">
  <div class="mx-auto max-w-screen-lg px-4 sm:px-6 lg:px-8">
    {/* Section heading */}
    <div class="mb-12 text-center lg:mb-16">
      <h2 class="text-3xl font-bold text-neutral-12 lg:text-4xl">
        What the <GradientText>Community</GradientText> Thinks
      </h2>
      <p class="mt-3 text-neutral-11">
        Real feedback from real users
      </p>
    </div>

    {/* Carousel container */}
    <div class="relative">
      {/* Quote cards wrapper */}
      <div class="quotes-carousel overflow-hidden">
        <div class="quotes-track flex transition-transform duration-500 ease-out">
          {quotes.map((quote) => (
            <div class="quote-slide w-full flex-shrink-0 px-4">
              <QuoteCard quote={quote} />
            </div>
          ))}
        </div>
      </div>

      {/* Navigation buttons */}
      <button
        class="quote-prev absolute left-0 top-1/2 -translate-y-1/2 -translate-x-2 rounded-full border border-neutral-6 bg-neutral-1 p-3 text-neutral-11 shadow-sm transition-all hover:border-accent-11 hover:text-accent-11 lg:-translate-x-4 dark:bg-neutral-3"
        aria-label="Previous quote"
      >
        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <path d="m15 18-6-6 6-6"/>
        </svg>
      </button>
      
      <button
        class="quote-next absolute right-0 top-1/2 -translate-y-1/2 translate-x-2 rounded-full border border-neutral-6 bg-neutral-1 p-3 text-neutral-11 shadow-sm transition-all hover:border-accent-11 hover:text-accent-11 lg:translate-x-4 dark:bg-neutral-3"
        aria-label="Next quote"
      >
        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <path d="m9 18 6-6-6-6"/>
        </svg>
      </button>
    </div>

    {/* Pagination dots */}
    <div class="quote-dots mt-8 flex justify-center gap-2">
      {quotes.map((_, index) => (
        <button
          class="quote-dot h-2 w-2 rounded-full bg-neutral-6 transition-all hover:bg-accent-11"
          data-index={index}
          aria-label={`Go to quote ${index + 1}`}
        />
      ))}
    </div>
  </div>
</section>

<script>
  const track = document.querySelector('.quotes-track') as HTMLElement | null
  const slides = document.querySelectorAll('.quote-slide')
  const prevBtn = document.querySelector('.quote-prev') as HTMLElement | null
  const nextBtn = document.querySelector('.quote-next') as HTMLElement | null
  const dots = document.querySelectorAll('.quote-dot')
  
  let currentIndex = 0
  const totalSlides = slides.length

  function updateCarousel() {
    if (track) {
      track.style.transform = `translateX(-${currentIndex * 100}%)`
    }
    
    // Update dots
    dots.forEach((dot: Element, index: number) => {
      const button = dot as HTMLElement
      if (index === currentIndex) {
        button.classList.add('bg-accent-11', 'w-6')
        button.classList.remove('bg-neutral-6')
      } else {
        button.classList.remove('bg-accent-11', 'w-6')
        button.classList.add('bg-neutral-6')
      }
    })
  }

  function goToSlide(index: number) {
    currentIndex = index
    if (currentIndex < 0) currentIndex = totalSlides - 1
    if (currentIndex >= totalSlides) currentIndex = 0
    updateCarousel()
  }

  if (prevBtn) {
    prevBtn.addEventListener('click', () => goToSlide(currentIndex - 1))
  }
  
  if (nextBtn) {
    nextBtn.addEventListener('click', () => goToSlide(currentIndex + 1))
  }

  dots.forEach((dot: Element, index: number) => {
    dot.addEventListener('click', () => goToSlide(index))
  })

  // Auto-advance every 5 seconds
  setInterval(() => {
    goToSlide(currentIndex + 1)
  }, 5000)

  // Initialize
  updateCarousel()
</script>

<style>
  .bg-dots::before {
    z-index: -1;
    content: "";
    position: absolute;
    left: 0;
    inset: 0;
    height: 100%;
    width: 100%;
    background-image: radial-gradient(var(--accent-5) 1px, transparent 1px);
    background-size: 16px 16px;
    -webkit-mask-image: radial-gradient(ellipse 50% 50% at 50% 50%, #000 60%, transparent 100%);
    mask-image: radial-gradient(ellipse 50% 50% at 50% 50%, #000 60%, transparent 100%);
    background-size: 24px 24px;
  }

  .quotes-carousel {
    position: relative;
  }

  .quotes-track {
    display: flex;
    width: 100%;
  }

  .quote-slide {
    min-width: 100%;
    flex-shrink: 0;
  }
</style>
